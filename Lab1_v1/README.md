# Задание 1 (вариант 1)

## Условие
Требуется разработать компонент для анализа изображений с применением готовой нейронной сети в формате ONNX. 

Вариант 1. Сеть ArcFace для вычисления вектора признаков лица. Пример: https://github.com/sergey-berezin/dotnet4/tree/master/onnx/ArcFace 

Вариант 2. Сеть EmotionFerPlus для определения эмоций. Пример: https://github.com/sergey-berezin/dotnet4/tree/master/onnx/EmotionFerPlus 

Требования к реализации: 

1. Компонент для распознавания должен принимать в качестве входных данных изображение в формате JPG или PNG и выдавать результат анализа изображения. 

2. Компонент размещен в отдельном пакете NuGet и должен быть переиспользован в последующих заданиях без перекомпиляции. Компонент должен быть максимально независим от среды использования, в частности 1) не использовать консольный ввод/вывод и 2) принимать содержимое файла в виде массива или потока байт. Пример пакета NuGet: https://github.com/sergey-berezin/dotnet4/tree/master/nuget 

3. Для распознавания изображений применяются заранее обученные модели из репозитория. Файл с моделью должен содержаться в сборке как встроенный ресурс.  

    - Пример использования Embedded Resource: https://github.com/sergey-berezin/dotnet4/tree/master/onnx/ShuffleNetEmbedded 

    - Как включить файл контента в пакет NuGet: https://devblogs.microsoft.com/nuget/nuget-contentfiles-demystified/ 

4. В целях экономии памяти компонент должен создавать только один экземпляр модели (сессии), но предоставлять асинхронный потокобезопасный API с возможностью отмены вычисления при помощи CancellationToken. 

5. Пакет Nuget должен использоваться в консольном приложении.  

    - Вариант 1. Приложение должно выдавать расстояние и меру схожести двух изображений.  

    - Вариант 2. Приложение должно выдавать вероятности всех классов эмоций для изображения.

## Сборка
1. Скачать [модель](https://github.com/onnx/models/blob/main/vision/body_analysis/arcface/model/arcfaceresnet100-8.onnx) и положить в папку `lib/`
2. Из дериктории `lib/` собрать nuget пакет:
```
dotnet pack
```
3. Из дериктории `app/` собрать приложение:
```
dotnet build
```
4. Следующая команда должна вывести в консоль справку о приложении:
```
dotnet run
```

## Тестирование
Приложение печатает в консоль сводные таблицы схожести и 'дистанции' эмбеддингов лиц, а также время, затраченное на вычисление этих значений. В директории `app/images/` есть несколько лиц известных личностей, на которых можно проверить работу приложения. Также есть возможность запустить приложение на своих данных, указав полный или относительный путь до изображений. Избражения должны быть в формате `png` или `jpg`, `112 x 112` пикселей.

1. Запуск тестов в синхронном режиме:
```
dotnet run test
```
2. Запуск тестов в асинхронном режиме:
```
dotnet run asynctest
```
3. Запуск сравнения лиц в синхронном режиме на своих данных:
```
dotnet run <image1> <image2> ...
```